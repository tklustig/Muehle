<!DOCTYPE html>
<html>
    <head>
        <title>Mühle spielen</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="css/bootstrap.css">
        <link rel="stylesheet" href="css/style.css">    
        <style>
            body{
                background-position: 10px 10px;
                background-image: url("img/brett.png");
                background-repeat: no-repeat; /* Do not repeat the image */
            }
        </style>
        <script src="js/jquery-1.7.1.min.js"></script>
        <script>
            //globale Variablen
            const accessMode = Object.freeze({
                schwarzerStein: 0,
                weisserStein: 1,
                setzen: 12,
                ziehen: 13
            });
            let istAnDerReihe = 0;
            let arHaveMoved = new Array();
            let arMuehleWhite = new Array();
            let arMuehleBlack = new Array();
            let muehle_pos_1 = true;
            let muehle_pos_1_dummy = false;
            let muehle_pos_2 = true;
            let muehle_pos_2_dummy = false;
            let muehle_pos_3 = true;
            let muehle_pos_3_dummy = false;
            let steinWurdeEntfernt = false;

            function allowDrop(ev) {
                ev.preventDefault();
            }

            function drag(ev) {
                ev.dataTransfer.setData("id", ev.target.id);
            }

            function drop(ev) {
                if (!steinWurdeEntfernt) {
                    istAnDerReihe++;
                    ev.preventDefault();
                    var data = ev.dataTransfer.getData("id");
                    var divB = ev.target.getAttribute('id');
                    if (divB.match("drag")) {
                        alert("Feld wurde bereits belegt. Bitte Anderes wählen!");
                        istAnDerReihe--;
                        return;
                    }
                    if (moveIsLegal(data, divB))
                        ev.target.appendChild(document.getElementById(data));
                    if (muehle()) {
                        alert("Sie haben eine Mühle! Entfernen Sie einen Stein!");
                        steinEntfernen(istAnDerReihe);
                    }
                } else
                    alert('Sie hatten eine Mühle. Wollen Sie keinen Stein entfernen?');
            }

            function Reload() {
                location.reload();
            }

            function moveIsLegal(data, targetDiv) {
                //Initialisierungen       
                var treffer;
                const arSteinWeissId = ["drag2", "drag4", "drag6", "drag8", "drag10", "drag12"];
                const arSteinBlackId = ["drag1", "drag3", "drag5", "drag7", "drag9", "drag11"];
                //Initialisierungsende
                if (istAnDerReihe % 2 === accessMode.weisserStein) {
                    if (arSteinWeissId.includes(data)) {
                        treffer = true;
                        arMuehleWhite.push(targetDiv);
                    } else
                        treffer = false;
                    if (!treffer) {
                        alert("Falscher Stein. Weiß ist an der Reihe!");
                        istAnDerReihe--;
                        return false;
                    }
                } else if (istAnDerReihe % 2 === accessMode.schwarzerStein) {
                    if (arSteinBlackId.includes(data)) {
                        treffer = true;
                        arMuehleBlack.push(targetDiv);
                    } else
                        treffer = false;
                    if (!treffer) {
                        alert("Falscher Stein. Schwarz ist an der Reihe!");
                        istAnDerReihe--;
                        return false;
                    }
                }
                if (istAnDerReihe <= accessMode.setzen) {
                    if (!arHaveMoved.includes(data)) {
                        arHaveMoved.push(data)
                        arHaveMoved.push(targetDiv);
                    } else {
                        alert("Zug ungültig: Erst alle Steine setzen, dann ziehen!");
                        istAnDerReihe--;
                        return false;
                    }
                }
                return true;
            }

            function muehle() {
                const arThreeInaRow_1 = ['div1', 'div2', 'div3'];
                const arThreeInaRow_2 = ['div1', 'div10', 'div22'];
                const arThreeInaRow_3 = ['div22', 'div23', 'div24'];
                if (arMuehleWhite.length >= 3) {
                    var isMuehle_1_White = arMuehleWhite.includes(arThreeInaRow_1[0]) && arMuehleWhite.includes(arThreeInaRow_1[1]) && arMuehleWhite.includes(arThreeInaRow_1[2]) && muehle_pos_1 ? true : false;
                    var isMuehle_2_White = arMuehleWhite.includes(arThreeInaRow_2[0]) && arMuehleWhite.includes(arThreeInaRow_2[1]) && arMuehleWhite.includes(arThreeInaRow_2[2]) && muehle_pos_2 ? true : false;
                    var isMuehle_3_White = arMuehleWhite.includes(arThreeInaRow_3[0]) && arMuehleWhite.includes(arThreeInaRow_3[1]) && arMuehleWhite.includes(arThreeInaRow_3[2]) && muehle_pos_3 ? true : false;
                }
                if (arMuehleBlack.length >= 3) {
                    var isMuehle_1_Black = arMuehleBlack.includes(arThreeInaRow_1[0]) && arMuehleBlack.includes(arThreeInaRow_1[1]) && arMuehleBlack.includes(arThreeInaRow_1[2]) && muehle_pos_1 ? true : false;
                    var isMuehle_2_Black = arMuehleBlack.includes(arThreeInaRow_2[0]) && arMuehleBlack.includes(arThreeInaRow_2[1]) && arMuehleBlack.includes(arThreeInaRow_2[2]) && muehle_pos_2 ? true : false;
                    var isMuehle_3_Black = arMuehleBlack.includes(arThreeInaRow_3[0]) && arMuehleBlack.includes(arThreeInaRow_3[1]) && arMuehleBlack.includes(arThreeInaRow_3[2]) && muehle_pos_3 ? true : false;
                }
                if (istAnDerReihe <= accessMode.setzen) {
                    if (isMuehle_1_White) {
                        steinWurdeEntfernt = !steinWurdeEntfernt;
                        muehle_pos_1 = false;
                        muehle_pos_1_dummy = true;
                        return true;
                    } else if (isMuehle_1_Black) {
                        steinWurdeEntfernt = !steinWurdeEntfernt;
                        muehle_pos_1 = false;
                        muehle_pos_1_dummy = true;
                        return true;
                    } else if (isMuehle_2_White) {
                        steinWurdeEntfernt = !steinWurdeEntfernt;
                        muehle_pos_2 = false;
                        muehle_pos_2_dummy = true;
                        return true;
                    } else if (isMuehle_2_Black) {
                        steinWurdeEntfernt = !steinWurdeEntfernt;
                        muehle_pos_2 = false;
                        muehle_pos_2_dummy = true;
                        return true;
                    } else if (isMuehle_3_White) {
                        steinWurdeEntfernt = !steinWurdeEntfernt;
                        muehle_pos_3 = false;
                        muehle_pos_3_dummy = true;
                        return true;
                    } else if (isMuehle_3_Black) {
                        steinWurdeEntfernt = !steinWurdeEntfernt;
                        muehle_pos_3 = false;
                        muehle_pos_3_dummy = true;
                        return true;
                    }
                } else if (istAnDerReihe >= accessMode.ziehen) {

                }
                return false;
            }

            function steinEntfernen(farbe) {
                const arSteinWeissId = ["drag2", "drag4", "drag6", "drag8", "drag10", "drag12"];
                const arSteinBlackId = ["drag1", "drag3", "drag5", "drag7", "drag9", "drag11"];
                if (istAnDerReihe <= accessMode.setzen) {
                    $("img").click(function () {
                        var stein = this.getAttribute('id');
                        if (farbe % 2 == accessMode.schwarzerStein && arSteinBlackId.includes(stein) || farbe % 2 == accessMode.weisserStein && arSteinWeissId.includes(stein)) {
                            if (muehle_pos_1_dummy) {
                                $(this).hide();
                                muehle_pos_1_dummy = false;
                                steinWurdeEntfernt = !steinWurdeEntfernt;
                            } else if (muehle_pos_2_dummy) {
                                muehle_pos_2_dummy = false;
                                $(this).hide();
                                steinWurdeEntfernt = !steinWurdeEntfernt;
                            } else if (muehle_pos_3_dummy) {
                                muehle_pos_3_dummy = false;
                                $(this).hide();
                                steinWurdeEntfernt = !steinWurdeEntfernt;
                            }
                            //Den geschlagenen Stein mittrels indexOf() aus dem Array arMuehleWhite||arMuehleBlack entfernen, damit keine Mühle angezeigt wird
                            for (var i = 0; i < arHaveMoved.length; i++) {
                                if (arHaveMoved[i] == stein) {
                                    var value2Delete = arHaveMoved[i + 1];
                                    alert(x);
                                }
                            }
                            return true;
                        } /*else
                         alert("Falsche Wahl. Bitte anderen Stein selektieren!");*/
                    });
                } else if (istAnDerReihe >= accessMode.ziehen) {

                }
                return false;
            }

        </script>
    </head>
    <body>
        <!-- Eckpunkte des Brettes -->
        <div id="div1" ondrop="drop(event)" ondragover="allowDrop(event)"></div> 
        <div id="div2" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        <div id="div3" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        <div id="div4" ondrop="drop(event)" ondragover="allowDrop(event)"></div> 
        <div id="div5" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        <div id="div6" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        <div id="div7" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        <div id="div8" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        <div id="div9" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        <div id="div10" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        <div id="div11" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        <div id="div12" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        <div id="div13" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        <div id="div14" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        <div id="div15" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        <div id="div16" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        <div id="div17" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        <div id="div18" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        <div id="div19" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        <div id="div20" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        <div id="div21" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        <div id="div22" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        <div id="div23" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        <div id="div24" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        <div class="steinWeiss">
            <img id="drag2" src="img/steinWhite.png" draggable="true" ondragstart="drag(event)" alt="NoImageFound">
            <img id="drag4" src="img/steinWhite.png" draggable="true" ondragstart="drag(event)" alt="NoImageFound">
            <img id="drag6" src="img/steinWhite.png" draggable="true" ondragstart="drag(event)" alt="NoImageFound">
            <img id="drag8" src="img/steinWhite.png" draggable="true" ondragstart="drag(event)" alt="NoImageFound">
            <img id="drag10" src="img/steinWhite.png" draggable="true" ondragstart="drag(event)" alt="NoImageFound">
            <img id="drag12" src="img/steinWhite.png" draggable="true" ondragstart="drag(event)" alt="NoImageFound">
        </div>
        <div class="steinSchwarz">
            <img id="drag1" src="img/steinBl.png" draggable="true" ondragstart="drag(event)" alt="NoImageFound">
            <img id="drag3" src="img/steinBl.png" draggable="true" ondragstart="drag(event)" alt="NoImageFound">
            <img id="drag5" src="img/steinBl.png" draggable="true" ondragstart="drag(event)" alt="NoImageFound">
            <img id="drag7" src="img/steinBl.png" draggable="true" ondragstart="drag(event)" alt="NoImageFound">
            <img id="drag9" src="img/steinBl.png" draggable="true" ondragstart="drag(event)" alt="NoImageFound">
            <img id="drag11" src="img/steinBl.png" draggable="true" ondragstart="drag(event)" alt="NoImageFound">
        </div>
        <!-- geschlagende Steine -->
        <button id="btnReload" class="btn btn-primary btn-sm" onclick="Reload()">New</button>
    </body>
</html>
